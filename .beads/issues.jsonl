{"id":"external-dns-docker-0ek","title":"RFC2136 provider implementation","description":"## Requirements\n- Implement AXFR zone transfer for listing current DNS records (Records method)\n- Implement DNS UPDATE (RFC2136) for applying changes (ApplyChanges method)\n- Support TSIG authentication (key name, secret, algorithm)\n- Configuration: host, port, zone, tsig-keyname, tsig-secret, tsig-secret-alg, min-ttl\n- Enforce minimum TTL when configured\n- Use github.com/miekg/dns for all DNS wire protocol operations\n\n## Acceptance Criteria\n- Records() returns all endpoints via AXFR\n- ApplyChanges() creates/updates/deletes records via DNS UPDATE\n- TSIG authentication is applied to all UPDATE messages\n- TSIG authentication failure returns an error without applying changes\n- min-ttl enforcement works correctly\n- Unit tests cover the provider logic\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/provider/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 6)\n- Key files: pkg/provider/rfc2136/rfc2136.go, pkg/provider/rfc2136/rfc2136_test.go\n- Dependency: github.com/miekg/dns","status":"closed","priority":2,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:47.53558423-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T16:11:30.144916502-08:00","closed_at":"2026-02-23T16:11:30.144921101-08:00","labels":["core","dns"]}
{"id":"external-dns-docker-105","title":"Docker source implementation","description":"## Requirements\n- Implement Docker client wrapper (pkg/source/docker.go) using github.com/docker/docker/client\n- List running containers and extract external-dns.io/* labels\n- Parse labels into Endpoints (hostname, target, ttl, record-type)\n- Support multi-record indexed labels (hostname-0, hostname-1, target-0, target-1)\n- Subscribe to Docker Events API: start, stop, die, update events\n- Auto-reconnect on Docker event stream disconnection\n- Skip containers missing required labels with appropriate log levels (silent skip for no hostname, warning for no target)\n\n## Acceptance Criteria\n- Docker source returns correct Endpoints for running containers with valid labels\n- Containers missing hostname label are silently skipped\n- Containers missing target label are skipped with a warning log\n- Invalid TTL values are rejected with a warning and the container is skipped\n- Multi-record indexed labels produce multiple Endpoints\n- Docker events trigger the registered event handler\n- Unit tests use mock Docker client (no live Docker required)\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/docker-source/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 4)\n- Key files: pkg/source/docker.go, pkg/source/docker_test.go","status":"closed","priority":2,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:32.035675756-08:00","created_by":"Ben Kero","updated_at":"2026-02-21T01:44:36.875509312-08:00","closed_at":"2026-02-21T01:44:36.875512128-08:00","labels":["core","docker"]}
{"id":"external-dns-docker-16a","title":"Plan/diff engine","description":"## Requirements\n- Implement Calculate(desired, current []*Endpoint) *Changes to diff DNS state\n- Produce Changes.Create for new records, UpdateOld/UpdateNew for changed records, Delete for removed\n- Implement TXT ownership record generation (companion record: external-dns-docker-owner.\u003cdns-name\u003e)\n- Ownership record value format: heritage=external-dns-docker,external-dns-docker/owner=\u003cowner-id\u003e\n- Filter: only modify/delete records with matching ownership TXT records\n- Records without ownership TXT records MUST NOT be deleted or updated\n- Owner ID is configurable (default: external-dns-docker)\n\n## Acceptance Criteria\n- New desired endpoint → appears in Changes.Create\n- Removed owned endpoint → appears in Changes.Delete\n- Changed target/TTL → appears in UpdateOld/UpdateNew\n- Unchanged endpoint → no change produced\n- Unowned record → not in Changes.Delete\n- Ownership TXT records created and deleted alongside their managed records\n- Unit test coverage \u003e= 80%\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/plan/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 7)\n- Key files: pkg/plan/plan.go, pkg/plan/plan_test.go","status":"closed","priority":3,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:57.569918198-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T16:15:19.134672852-08:00","closed_at":"2026-02-23T16:15:19.13467667-08:00","labels":["core"]}
{"id":"external-dns-docker-1gd","title":"Unit tests for all packages","description":"## Requirements\n- Ensure \u003e= 80% statement coverage on all packages: pkg/endpoint, pkg/source, pkg/provider/rfc2136, pkg/plan, pkg/controller\n- All unit tests run with go test ./... and require no external services\n- Use fake source (pkg/source/fake) and fake provider (pkg/provider/fake) for controller tests\n- Use mock Docker client for source tests\n\n## Acceptance Criteria\n- go test ./... passes with zero failures\n- go test -cover ./... shows \u003e= 80% coverage per package\n- Tests run without Docker socket or live DNS server\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/testing/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 10)\n- Related issues: endpoint data model, Docker source, RFC2136 provider, plan engine, controller","status":"closed","priority":4,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:30:25.356490975-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T17:17:52.28183375-08:00","closed_at":"2026-02-23T17:17:52.281835604-08:00","labels":["testing"]}
{"id":"external-dns-docker-27t","title":"Integration/e2e tests (Docker Compose + BIND9)","description":"## Requirements\n- Create test/integration/docker-compose.yml with BIND9 configured for RFC2136 updates and test containers\n- Write test scenario: container start → A record created in BIND9\n- Write test scenario: container stop → DNS record deleted from BIND9\n- Write test scenario: unowned records in BIND9 are NOT deleted during reconciliation\n- Tests run with docker compose up and go test ./test/integration/...\n\n## Acceptance Criteria\n- Docker Compose setup starts BIND9 and test containers successfully\n- Container start creates the expected DNS record in BIND9\n- Container stop removes the DNS record\n- Records without ownership TXT records are preserved\n- Integration tests are tagged and can be excluded from unit test runs (e.g., //go:build integration)\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/testing/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 11)\n- Key files: test/integration/docker-compose.yml, test/integration/*_test.go","status":"closed","priority":4,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:30:34.160001435-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T17:07:36.997914031-08:00","closed_at":"2026-02-23T17:07:36.997914031-08:00","close_reason":"Closed","labels":["infrastructure","testing"]}
{"id":"external-dns-docker-2ts","title":"Endpoint data model","description":"## Requirements\n- Define Endpoint struct: DNSName (string), Targets ([]string), RecordType (string), TTL (int64), Labels (map[string]string)\n- Implement RecordType auto-detection: IPv4 → A, IPv6 → AAAA, hostname → CNAME\n- Add endpoint helpers and String() method\n- Write unit tests for pkg/endpoint/\n\n## Acceptance Criteria\n- Endpoint struct correctly models all DNS record fields\n- Auto-detection correctly classifies IPv4, IPv6, and hostname targets\n- record-type label override works correctly\n- Unit test coverage \u003e= 80%\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/endpoint/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 2)\n- Key files: pkg/endpoint/endpoint.go, pkg/endpoint/endpoint_test.go","status":"closed","priority":1,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:14.2318924-08:00","created_by":"Ben Kero","updated_at":"2026-02-21T01:35:42.128983505-08:00","closed_at":"2026-02-21T01:35:42.128985519-08:00","labels":["core"]}
{"id":"external-dns-docker-6ry","title":"Project scaffolding (go.mod, Makefile, Dockerfile, README)","description":"## Requirements\n- Initialize Go module with go.mod and go.sum (module: github.com/bkero/external-dns-docker, Go 1.22+)\n- Create Makefile with targets: build, test, lint, docker\n- Create multi-stage Dockerfile supporting linux/amd64 and linux/arm64\n- Write README.md with quickstart instructions and label reference table\n\n## Acceptance Criteria\n- go build ./... succeeds\n- make build produces a binary in bin/\n- docker build succeeds\n- README documents all supported labels and basic usage\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/proposal.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 1)\n- Design: openspec/changes/add-core-dns-management/design.md\n- Code layout: cmd/external-dns-docker/, pkg/, test/integration/","status":"closed","priority":1,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:06.893724412-08:00","created_by":"Ben Kero","updated_at":"2026-02-21T01:34:23.213275546-08:00","closed_at":"2026-02-21T01:34:23.2132777-08:00","labels":["infrastructure"]}
{"id":"external-dns-docker-7i2","title":"CI setup (GitHub Actions)","description":"## Requirements\n- Create .github/workflows/ci.yml with stages: lint (golangci-lint), unit tests, integration tests, Docker build\n- Add .golangci.yml configuration for golangci-lint\n- Configure multi-arch Docker build via buildx: linux/amd64 and linux/arm64\n- Push Docker image to registry on merge to main (tagged with commit SHA) and on version tags (vX.Y.Z)\n- Configure semantic release / auto-tagging: feat commits → minor bump, fix commits → patch bump, BREAKING → major bump\n\n## Acceptance Criteria\n- PRs trigger full CI: lint + unit tests + integration tests + Docker build\n- Lint failures block merge\n- Unit test failures block merge\n- Multi-arch image is built for both platforms\n- Merge to main produces a commit-SHA-tagged image in the registry\n- Version tags produce a vX.Y.Z-tagged image\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/ci/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 12)\n- Key files: .github/workflows/ci.yml, .golangci.yml","status":"closed","priority":4,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:30:43.488144195-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T16:48:41.461503662-08:00","closed_at":"2026-02-23T16:48:41.461503662-08:00","close_reason":"Closed","labels":["ci","infrastructure"]}
{"id":"external-dns-docker-bag","title":"CLI entry point (main.go + config)","description":"## Requirements\n- Create cmd/external-dns-docker/main.go as the daemon entry point\n- Define all CLI flags with EXTERNAL_DNS_ environment variable overrides\n- Wire up: Docker source, RFC2136 provider, plan engine, and controller\n- Configure structured JSON logging via log/slog (configurable level via --log-level)\n- Support graceful shutdown on SIGTERM and SIGINT\n- Expose flags: --rfc2136-host, --rfc2136-port, --rfc2136-zone, --rfc2136-tsig-*, --docker-host, --docker-tls-*, --interval, --once, --dry-run, --log-level, --owner-id\n\n## Acceptance Criteria\n- Daemon starts and connects to Docker socket and DNS server\n- All config is settable via flags or EXTERNAL_DNS_* env vars; flags override env vars\n- Graceful shutdown on SIGTERM/SIGINT completes current reconciliation cycle\n- --dry-run flag works correctly\n- --once flag runs one cycle and exits\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/configuration/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 9)\n- Key files: cmd/external-dns-docker/main.go","status":"closed","priority":3,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:30:17.91692351-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T16:39:35.170262774-08:00","closed_at":"2026-02-23T16:39:35.170262774-08:00","close_reason":"Closed","labels":["core"]}
{"id":"external-dns-docker-ccw","title":"fix: propagate context and add timeout to RFC2136 DNS operations","description":"## Requirements\n- Pass context through to dns.Client.Exchange() and dns.Transfer.In() calls\n- Set a configurable timeout on dns.Client (flag: --rfc2136-timeout, default 10s)\n- Cancel in-flight DNS operations when the context is cancelled (e.g. on SIGTERM)\n\n## Acceptance Criteria\n- SIGTERM causes clean exit even when DNS server is unreachable\n- Unit test verifies timeout behaviour\n- --rfc2136-timeout flag is documented\n\n## Context\npkg/provider/rfc2136/rfc2136.go:98 (Records) and :126 (ApplyChanges) accept ctx but ignore it.\ndns.Client at line 72 has no Timeout set. A blocked AXFR/UPDATE can prevent graceful shutdown\nindefinitely and cause reconciliation loop stalls.","status":"open","priority":1,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-24T12:10:16.726905316-08:00","created_by":"Ben Kero","updated_at":"2026-02-24T12:10:16.726905316-08:00"}
{"id":"external-dns-docker-ehq","title":"Provider interface definition","description":"## Requirements\n- Define Provider interface: Records(ctx) ([]*Endpoint, error) and ApplyChanges(ctx, *Changes) error\n- Define Changes struct with Create, UpdateOld, UpdateNew, Delete endpoint slices\n- Create fake/in-memory provider for unit testing (pkg/provider/fake)\n- Fake provider stores records in memory and allows test inspection of applied changes\n\n## Acceptance Criteria\n- Provider interface is defined and documented\n- Changes struct covers all CRUD operations\n- Fake provider correctly applies and reflects changes in memory\n- Fake provider records change history for test assertions\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/provider/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 5)\n- Key files: pkg/provider/provider.go, pkg/provider/fake/fake.go","status":"closed","priority":2,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:38.824737739-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T14:50:22.880414818-08:00","closed_at":"2026-02-23T14:50:22.880418725-08:00","labels":["core"]}
{"id":"external-dns-docker-f1k","title":"Controller / reconciliation loop","description":"## Requirements\n- Implement periodic reconciliation loop with configurable interval (default 60s)\n- Each cycle: fetch desired from source, fetch current from provider, calculate plan, apply changes\n- Trigger additional reconciliation on Docker events via Source.AddEventHandler\n- Debounce rapid events within configurable window (default 5s)\n- Implement dry-run mode: log planned changes without calling ApplyChanges\n- Implement once mode: run exactly one cycle then exit (exit code 0 on success, non-zero on error)\n- Log but do not crash on transient errors during any reconciliation step\n- Support graceful shutdown via context cancellation\n\n## Acceptance Criteria\n- Periodic reconciliation runs at configured interval\n- Docker events trigger fast reconciliation within debounce window\n- Multiple events within debounce window trigger only one cycle\n- dry-run mode logs changes without modifying DNS\n- once mode exits after single successful cycle\n- Transient provider errors are logged; daemon continues\n- Unit tests cover controller logic using fake source and fake provider\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/controller/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 8)\n- Key files: pkg/controller/controller.go, pkg/controller/controller_test.go","status":"closed","priority":3,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:30:08.011376275-08:00","created_by":"Ben Kero","updated_at":"2026-02-23T16:31:09.371497238-08:00","closed_at":"2026-02-23T16:31:09.371497238-08:00","close_reason":"Closed","labels":["core"]}
{"id":"external-dns-docker-o75","title":"Source interface definition","description":"## Requirements\n- Define Source interface with Endpoints(ctx) and AddEventHandler(ctx, handler) methods\n- Create fake/in-memory source for unit testing (pkg/source/fake)\n- Fake source accepts pre-configured endpoint list and supports manual event triggering\n\n## Acceptance Criteria\n- Source interface is defined and documented\n- Fake source correctly returns configured endpoints\n- Fake source triggers registered event handlers when TriggerEvent() is called\n\n## Context\n- Spec: openspec/changes/add-core-dns-management/specs/docker-source/spec.md\n- Tasks: openspec/changes/add-core-dns-management/tasks.md (section 3)\n- Key files: pkg/source/source.go, pkg/source/fake/fake.go","status":"closed","priority":2,"issue_type":"task","owner":"bkero@bke.ro","created_at":"2026-02-21T01:29:21.352915166-08:00","created_by":"Ben Kero","updated_at":"2026-02-21T01:37:17.929384456-08:00","closed_at":"2026-02-21T01:37:17.92938684-08:00","labels":["core"]}
